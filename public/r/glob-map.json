{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "glob-map",
  "type": "registry:component",
  "dependencies": [
    "d3",
    "@radix-ui/react-slot",
    "class-variance-authority",
    "topojson-client",
    "tailwind-merge",
    "clsx"
  ],
  "devDependencies": [],
  "registryDependencies": [],
  "files": [
    {
      "path": "./src/components/nurui/glob-map-demo.tsx",
      "content": "import { GlobeToMapTransform } from \"@/components/nurui/glob-map\";\n\nexport default function GlobMapDemo() {\n  return (\n    <div className=\"m-20 relative flex flex-col h-[600px] w-[840px] rounded-2xl p-4 justify-stretch items-stretch gap-2 overflow-clip bg-[#3ca2fa0d] border border-[#3ca2fa66]\">\n      <div className=\"flex flex-col gap-1 my-1\">\n        <h3 className=\" mx-2\">Globe To Map Transform</h3>\n        <p className=\"text-neutral-500 mx-2 text-sm\">\n          Interactive visualization that smoothly transforms a 3D globe into a\n          2D equirectangular map.\n        </p>\n      </div>\n      <div className=\"flex p-2 w-full flex-1 min-h-32 justify-center items-center\">\n        <GlobeToMapTransform />\n      </div>\n      <div className=\"flex flex-col gap-1 my-1\">\n        <p className=\"text-neutral-500 mx-2 text-sm\">\n          Controls: Unroll Globe to transition to map view, Roll to Globe to\n          return, and Reset to clear rotation.\n        </p>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "./src/components/nurui/glob-map.tsx",
      "content": "/* eslint-disable @typescript-eslint/no-explicit-any */\n\"use client\";\n\nimport type React from \"react\";\n\nimport { Button } from \"@/components/nurui/button\";\nimport * as d3 from \"d3\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { feature } from \"topojson-client\";\n\ninterface GeoFeature {\n  type: string;\n  geometry: any;\n  properties: any;\n}\n\nfunction interpolateProjection(raw0: any, raw1: any) {\n  const mutate: any = d3.geoProjectionMutator(\n    (t: number) => (x: number, y: number) => {\n      const [x0, y0] = raw0(x, y);\n      const [x1, y1] = raw1(x, y);\n      return [x0 + t * (x1 - x0), y0 + t * (y1 - y0)];\n    },\n  );\n  let t = 0;\n  return Object.assign((mutate as any)(t), {\n    alpha(_: number) {\n      return arguments.length ? (mutate as any)((t = +_)) : t;\n    },\n  });\n}\n\nexport function GlobeToMapTransform() {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const [isAnimating, setIsAnimating] = useState(false);\n  const [progress, setProgress] = useState([0]);\n  const [worldData, setWorldData] = useState<GeoFeature[]>([]);\n  const [rotation, setRotation] = useState([0, 0]);\n  const [translation, setTranslation] = useState([0, 0]);\n  const [isDragging, setIsDragging] = useState(false);\n  const [lastMouse, setLastMouse] = useState([0, 0]);\n\n  const width = 800;\n  const height = 500;\n\n  // Load world data\n  useEffect(() => {\n    const loadWorldData = async () => {\n      try {\n        // Using Natural Earth data from a CDN\n        const response = await fetch(\n          \"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json\",\n        );\n        const world: any = await response.json();\n        // topojson-client's `feature` return type can be ambiguous; cast to any/FeatureCollection to access .features\n        const countries = (feature(world, world.objects.countries) as any)\n          .features;\n        setWorldData(countries);\n        console.log(\n          \"[v0] Successfully loaded world data with\",\n          countries.length,\n          \"countries\",\n        );\n      } catch (error) {\n        console.log(\"[v0] Error loading world data:\", error);\n        // Fallback: create a simple world outline\n        const fallbackData = [\n          {\n            type: \"Feature\",\n            geometry: {\n              type: \"Polygon\",\n              coordinates: [\n                [\n                  [-180, -90],\n                  [180, -90],\n                  [180, 90],\n                  [-180, 90],\n                  [-180, -90],\n                ],\n              ],\n            },\n            properties: {},\n          },\n        ];\n        setWorldData(fallbackData);\n      }\n    };\n\n    loadWorldData();\n  }, []);\n\n  const handleMouseDown = (event: React.MouseEvent) => {\n    setIsDragging(true);\n    const rect = svgRef.current?.getBoundingClientRect();\n    if (rect) {\n      setLastMouse([event.clientX - rect.left, event.clientY - rect.top]);\n    }\n  };\n\n  const handleMouseMove = (event: React.MouseEvent) => {\n    if (!isDragging) return;\n\n    const rect = svgRef.current?.getBoundingClientRect();\n    if (!rect) return;\n\n    const currentMouse = [event.clientX - rect.left, event.clientY - rect.top];\n    const dx = currentMouse[0] - lastMouse[0];\n    const dy = currentMouse[1] - lastMouse[1];\n\n    const t = progress[0] / 100;\n\n    if (t < 0.5) {\n      // Globe mode - rotate\n      const sensitivity = 0.5;\n      // NOTE: flip horizontal sign so dragging right rotates globe to the right\n      setRotation((prev) => [\n        prev[0] + dx * sensitivity,\n        Math.max(-90, Math.min(90, prev[1] - dy * sensitivity)),\n      ]);\n    } else {\n      // Map mode - rotate the projection (not simple pan)\n      // This updates the projection.rotate(...) used when in equirectangular mode.\n      const sensitivityMap = 0.25; // lower sensitivity for longitude/latitude rotation\n      setRotation((prev) => [\n        prev[0] + dx * sensitivityMap,\n        Math.max(-90, Math.min(90, prev[1] - dy * sensitivityMap)),\n      ]);\n    }\n\n    setLastMouse(currentMouse);\n  };\n\n  const handleMouseUp = () => {\n    setIsDragging(false);\n  };\n\n  // Initialize and update visualization\n  useEffect(() => {\n    if (!svgRef.current || worldData.length === 0) return;\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll(\"*\").remove();\n\n    const t = progress[0] / 100;\n    const alpha = Math.pow(t, 0.5); // Ease-out for smoother animation\n\n    const scale = d3.scaleLinear().domain([0, 1]).range([200, 120]);\n    const baseRotate = d3.scaleLinear().domain([0, 1]).range([0, 0]);\n\n    const projection = interpolateProjection(\n      d3.geoOrthographicRaw,\n      d3.geoEquirectangularRaw,\n    )\n      .scale(scale(alpha))\n      .translate([width / 2 + translation[0], height / 2 + translation[1]])\n      .rotate([baseRotate(alpha) + rotation[0], rotation[1]])\n      .precision(0.1);\n\n    // Set the interpolation parameter\n    projection.alpha(alpha);\n\n    // Create path generator\n    const path = d3.geoPath(projection);\n\n    // Add graticule (grid lines) above ocean fill but below countries\n    try {\n      const graticule = d3.geoGraticule();\n      const graticulePath = path(graticule());\n      if (graticulePath) {\n        svg\n          .append(\"path\")\n          .datum(graticule())\n          .attr(\"d\", graticulePath)\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"#3ca2fa\")\n          .attr(\"stroke-width\", 1)\n          .attr(\"opacity\", 0.2);\n      }\n    } catch (error) {\n      console.log(\"[v0] Error creating graticule:\", error);\n    }\n\n    // Add countries\n    svg\n      .selectAll(\".country\")\n      .data(worldData)\n      .enter()\n      .append(\"path\")\n      .attr(\"class\", \"country\")\n      .attr(\"d\", (d) => {\n        try {\n          const pathString = path(d as any);\n          if (!pathString) return \"\";\n          if (\n            typeof pathString === \"string\" &&\n            (pathString.includes(\"NaN\") || pathString.includes(\"Infinity\"))\n          ) {\n            return \"\";\n          }\n          return pathString;\n        } catch (error) {\n          console.log(\"[v0] Error generating path for country:\", error);\n          return \"\";\n        }\n      })\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", \"#3ca2fa\")\n      .attr(\"stroke-width\", 1.0)\n      .attr(\"opacity\", 1.0)\n      .style(\"visibility\", function () {\n        const pathData = d3.select(this).attr(\"d\");\n        return pathData && pathData.length > 0 && !pathData.includes(\"NaN\")\n          ? \"visible\"\n          : \"hidden\";\n      });\n    // hover handlers removed to keep country borders style constant\n\n    // Draw sphere outline on top so the map border overlays countries\n    try {\n      const sphereOutline = path({ type: \"Sphere\" });\n      if (sphereOutline) {\n        svg\n          .append(\"path\")\n          .datum({ type: \"Sphere\" })\n          .attr(\"d\", sphereOutline)\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"#3ca2fa\")\n          .attr(\"stroke-width\", 1)\n          .attr(\"opacity\", 1.0);\n      }\n    } catch (error) {\n      console.log(\"[v0] Error creating sphere outline:\", error);\n    }\n\n    console.log(\"[v0] Visualization updated with progress:\", progress[0]);\n  }, [worldData, progress, rotation, translation]);\n\n  const handleAnimate = () => {\n    if (isAnimating) return;\n\n    setIsAnimating(true);\n    const startProgress = progress[0];\n    const endProgress = startProgress === 0 ? 100 : 0;\n    const duration = 2000;\n\n    const startTime = Date.now();\n\n    const animate = () => {\n      const elapsed = Date.now() - startTime;\n      const t = Math.min(elapsed / duration, 1);\n\n      // Smooth easing function\n      const eased = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n      const currentProgress =\n        startProgress + (endProgress - startProgress) * eased;\n\n      setProgress([currentProgress]);\n\n      if (t < 1) {\n        requestAnimationFrame(animate);\n      } else {\n        setIsAnimating(false);\n      }\n    };\n\n    animate();\n  };\n\n  const handleReset = () => {\n    setRotation([0, 0]);\n    setTranslation([0, 0]);\n  };\n\n  return (\n    <div className=\"relative flex items-center justify-center w-full h-full\">\n      <svg\n        ref={svgRef}\n        viewBox={`0 0 ${width} ${height}`}\n        className=\"w-full h-full border rounded-lg bg-transparent border-[#3ca2fa66] cursor-grab active:cursor-grabbing\"\n        preserveAspectRatio=\"xMidYMid meet\"\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n      />\n      <div className=\"absolute bottom-2 right-4 flex gap-2 z-10\">\n        <Button\n          onClick={handleAnimate}\n          disabled={isAnimating}\n          className=\"cursor-pointer min-w-[120px] rounded\"\n        >\n          {isAnimating\n            ? \"Animating...\"\n            : progress[0] === 0\n              ? \"Unroll Globe\"\n              : \"Roll to Globe\"}\n        </Button>\n        <Button\n          onClick={handleReset}\n          variant=\"outline\"\n          className=\"cursor-pointer min-w-[80px] dark:text-white border-black dark:border-white/20 hover:bg-white/5 bg-transparent rounded\"\n        >\n          Reset\n        </Button>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "./src/components/nurui/button.tsx",
      "content": "import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n",
      "type": "registry:component"
    }
  ]
}